# Microsoft Teams 会話支援AI拡張機能 要件定義書

## 1. 背景・目的

Microsoft Teams 上のチャットにおいて、AIが過去の会話履歴や組織情報を考慮し、
自然で適切な返信文を提案・修正できる拡張機能を提供する。

チャット画面と並行して別タブで動作することで、ユーザーの意思決定を支援する。

---

## 2. 利用シーン

- ビジネスチャットでの返信文を「1から生成」または「自身の下書きを丁寧に修正」
- Teamsチャット本体を見ながら、別タブで補助UIを利用して返信内容を構築

---

## 3. 機能要件

| カテゴリ             | 要件概要                                                                 |
|----------------------|--------------------------------------------------------------------------|
| チャット履歴取得       | 現在のスレッドの直近履歴を最大N件まで取得（Graph APIなどを利用）               |
| 組織情報取得          | 相手の部署・役職・チーム構成などをGraph APIで取得                               |
| 返信候補生成          | 会話履歴＋組織情報＋プロンプトに基づいてAIが候補文を生成                         |
| 文脈修正機能          | ユーザーが入力した下書き文をもとに敬語・言い換え・要約などをAIが提案               |
| 一時メモリ保持         | DBを使わず、クライアントメモリやセッションストレージなどで履歴を一時保持           |
| 2タブ連携UI構成        | Teamsチャット画面 + 拡張機能タブ（会話支援）を2画面で表示                        |
| 送信欄への連携         | 候補文をチャット送信欄へ転送する機能を提供（SDKやDeepLinkで実現）                 |
| 候補提示・編集・確定    | 候補文を複数表示 → 選択 → 編集 → 送信欄へ転送 → Teamsで送信                     |

---

## 4. UI/UX要件

| 画面             | 要件概要                                                                 |
|------------------|--------------------------------------------------------------------------|
| 会話支援タブ        | 左側に履歴や入力欄、右側に「返信案生成」「修正文送信」などのフォームとボタンを配置      |
| 修正モード         | 「丁寧に」「要約」「言い換え」「英訳」などのモード選択が可能                         |
| チャット送信欄連携   | 候補文のワンクリックでTeams送信欄へ挿入（手動送信を基本とする）                        |

---

## 5. 非機能要件

- **セキュリティ**：DBを使用せず一時保持、個人情報・会話内容を外部に保存しない構成
- **プライバシー**：取得情報は最小限にとどめ、一定時間後に自動破棄
- **レスポンス速度**：2秒以内の候補表示を目指す
- **アクセシビリティ**：ショートカットやタブ操作で素早く利用できる設計

---

## 6. 技術構成

| 要素             | 詳細内容                                                                    |
|------------------|-----------------------------------------------------------------------------|
| フロントエンド       | React または Blazor による Teams拡張タブアプリ                                     |
| バックエンド       | Node.js または Spring Boot（LLM呼び出し・一時セッション管理）                      |
| AI / LLM        | Azure OpenAI / GPT API（プロンプト調整で出力品質制御）                             |
| Graph API       | 組織ユーザー情報やメッセージ取得に使用（Microsoft Identity Platform連携）           |
| 状態保持         | クライアントメモリ or Bot Framework Memory or Redis（任意）                        |
| 認証              | OAuth 2.0（Azure AD経由）、必要に応じてTeams SSO連携                            |

---

## 7. 次のステップ

1. Teamsアプリでの**複数タブ表示構成**の検証  
2. `@microsoft/teams-js` を用いた送信欄連携機能のプロトタイプ作成  
3. 修正モード（プロンプトテンプレート）の詳細定義  
4. UIのモックアップ作成  
5. セキュリティレビューと組織要件への準拠確認

---

## 8. 備考

- 送信欄への転送は、Clipboard API + DeepLink での連携も視野に
- ローカル保存やログの記録は行わず、セッション終了時にすべて破棄
- LLMによる生成文には明確な「AI生成ラベル」や目印を付与することを検討

